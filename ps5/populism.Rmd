---
title: 'Populism'
subtitle: "Problem Set - Empirics"
author: "Dianyi Yang <br>GV482^[Questions? Email [l.bosshart@lse.ac.uk](mailto:l.bosshart@lse.ac.uk).<br>R adaption of Stephane Wolton's STATA problem set implemented by [Felix Wortmann Callej√≥n](https://www.wortmanncallejon.de).]"
date: "`r as.character(Sys.Date())`"
output:
  bookdown::html_document2:
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
	warning = FALSE,
  root.dir = "D:/OneDrive - London School of Economics/Desktop/lse assignments/GV482/ps5")
#dirname(rstudioapi::getSourceEditorContext()$path)
setwd("D:/OneDrive - London School of Economics/Desktop/lse assignments/GV482/ps5") #change to your own directory

need <- c('tidyverse','haven','modelsummary',"TAM","fixest","estimatr","kableExtra") # list packages
have <- need %in% rownames(installed.packages()) # checks packages you have
if(any(!have)) install.packages(need[!have]) # install missing packages
invisible(lapply(need, library, character.only=T))

rm(list = ls())

```

In the lecture, we have described different possible explanations for the growing division between the elite and the commoners. We have discussed rapidly the effect of cultural shocks (and you will see more of it in your empirical exercise). We have spent quite a bit of time discussing the role of immigration. We went very quickly over the economic factors. This was, as pointed out in the lecture, on purpose since this empirical problem set will dig deeper into one of the most mentioned culprit behind the populist wave: globalization.

To investigate the effect of globalization, we will look at one of the many papers on the subject: "Importing political polarization? The electoral consequences of rising trade exposure." by Autor, Dorn, Hanson, and Majlesi published in the American Economic Review (vol. 110, no. 10: 3139-83). The paper focuses on one recent and prominent change in trade: the rise of China. Since its entry into the World Trade Organization, China has become the manufacture of the world. This has had dramatic impact on manufacturing in the United States as shown by Autor, Dorn, and Hanson in "The China Syndrome: Local Labor Market Effects of Import Competition in the United States." (American Economic Review 103 (6): 2121{68, 2013). The next logical step is to look at the political consequences of this trade shock, and this is exactly what the authors do in the paper we will study.

The paper is very rich, and you are strongly encouraged to read it (it is on the Moodle website of the course). In it, the authors look at the effect of the China shock on: the viewership patterns of news channels (right-wing Fox News, left-leaning CNN, left-wing MSNBC), the polarization of legislators (measured in term of whom candidates receive money from as well as in term of the ideology of elected representatives), Congressional elections, and finally on presidential elections.

We will concentrate on this last part of the paper (you may want to try to replicate some of the other parts as well, it is always a good exercise). There are two reasons for this. First, it allows us to work at the level of counties which is an administrative level for which we have a large set of data. Second, we can learn more about the biggest prize - the Presidency -, which obviously means to investigate the most shocking result of all: Trump's victory.

As this is your second empirical problem set, we will still provide quite a bit of guidance (especially in the first questions). Recall that you can submit your problem set (can submit one per study group) to Luis on **Thursday 15 February**. The submission deadline is **Thursday 15 at 12pm**. Submission is via email at <href a = mailto:l.bosshart@lse.ac.uk>[l.bosshart\@lse.ac.uk](mailto:l.bosshart@lse.ac.uk){.email}</href>.

Our first goal is to understand how Autor et al. measure Chinese import penetration. They do not have the direct effect of Chinese importation. That is, the researchers or us do not have a measure that say that x% of the industrial base went bust because of Chinese importations. We, as scholars, are forced to work with indirect measures. One possible solution is to look at the economic competition from China. But even then, nothing is so easy. We can measure competition at the national level for various industries. It is much harder to know at the county-level (our geographical unit) how disruptive the rise of China has been. To approximate the increase in competitive pressure due to the China shock, Autor et al. use a combination of national-time varying information and local data. They construct the level of China competition in area $j$ at date $\tau$, where $\tau \in \{2002,...,2010\}$ as

```{=tex}
\begin{equation}
  IP_{j\tau}^{us} = \sum_k \frac{L_{kjt_0}}{L_{jt_0}}IP_{k\tau}^{us} (\#eq:importpenetration)
\end{equation}
```
We will go over each term in this equation. The index $k$ represents different industries. Industries are classified according to the Standard Industrial Classiffcation (SIC) Code at the 4-digit level (the lowest level of aggregation). One example of SIC code is "2844 - Perfumes, Cosmetics, and other Toilet Preparations," which belongs to "284 - Soap, Detergents, and Cleaning Preparations; Perfumes, Cosmetics, and Other Toilet Preparations," which itself belongs to "28 - Chemicals and Allied Products," which itself is a subcategory of "20-39 - Manufacturing."[^1]

[^1]: For more information on SIC code, please check (the official website)[<https://siccode.com/sic-code-lookup-directory>].

$L_{kjt_0}$ represents the number of workers in industry $k$ in area $j$ at a baseline date $t_0$. $L_{jt_0}$ is the total number of workers in area $j$ at a baseline date $t_0$. $\frac{L_{kjt_0}}{L_{jt_0}}$ , therefore, captures the share of workers in industry $k$ in area $j$ in the baseline year. Note that only manufacturing industries are used. The authors use the year 2000 as their baseline so prior to the entry of China into the WTO.

**Q1:** Why would measuring the share of employment at date $\tau$ create inference problems?

[The share of employment at date $\tau$ would create inference problems because it would have been affected by the China shock and becomes an outcome variable rather than an explanatory variable. Assuming that the China shock has a differential impact across sectors, those sectors more exposed to Chinese import competition would have lost more jobs, hence a lower share of employment. This will be mistaken as "lower Chinese importation" and produce a downward bias on the results.]{style="color: blue;"}

Finally, $IP^{us}_{k\tau}$ is the level of importation from China in industry $k$ at date $\tau$. This is relative to the national level of production of industry $k$ in the United States prior to the economic opening of China, for which the authors use the date 1991. That is, $IP^{us}_{k\tau} = \frac{M^{us}_{k\tau}}{Y_{k0}+M_{k0}-X_{k0}}$ with $M^{us}_{k\tau}$ the importation from China at date $\tau$, $Y_{k0}+M_{k0}$ the US shipment (domestic production + importations), and $X_{k0}$ the exportations measured in 1991.

The authors often use the change in Chinese import penetration. That is, they use (see Equation (1) on page 3152):

```{=tex}
\begin{equation}
  \Delta IP^{us}_{j\tau} = IP^{us}_{j\tau} - IP^{us}_{jt}  (\#eq:importpenetrationchange)
\end{equation}
```
Autor et al. are worried that simply looking at the (change in) Chinese penetrations is unlikely to recover the effect of the disruptions caused by globalization (via the China shock). Indeed, they argue that the OLS estimator is likely to induce a downward bias.

**Q2:** What is their justification for this claim?

[The justification for this claim is that the change in Chinese penetrations is endogenous. If the penetration of Chinese imports led to unemployment in some sectors, there would likely be local boycotts in return would have reduced imports from China in the corresponding sectors. The effect is therefore bidirectional. This is likely to induce a downward bias in the OLS estimate as the signs of the effects are opposite - more Chinese imports likely create more unemployment, but more unemployment likely reduce Chinese imports.]{style="color: blue;"}

The authors use an instrumental variable to deal with this endogeneity issue. Rather than using importations from China in the US in Equation \@ref(eq:importpenetration) and Equation \@ref(eq:importpenetrationchange), they use importation in other developed countries: Australia, Denmark, Finland, Germany, Japan, New Zealand, Spain, and Switzerland. That is, they compute the following alternative change in import penetrations:

```{=tex}
\begin{equation}
\Delta IP^{out}_{j\tau}= \sum_k \frac{L_{kjt_0-10}}{L_{jt_0-10}}\Delta IP^{out}_{k\tau} (\#eq:importpenetrationIV)
\end{equation}
```
with $\Delta IP^{out}_{k\tau}= \frac{M^{out}_{k\tau} - M^{out}_{kt_0}}{Y_{k0-3}+M_{k0-3}- X_{k0-3}}$ and $out$ designating the fact that the importations are to other developed countries. Note that (i) the Labor shares are measured in area $j$ in the US, but with a 10 years lag relative to the direct measure in Equation \@ref(eq:importpenetration) (note the $t_{0 - 10}$) and (ii) the importations are relative to the net shipment in the US in 1987. There is a lively academic debate regarding whether and why this instrument may actually be valid (always a big question). We will take the validity of the instrument as given for the purpose of this problem set. More generally, you should always be worried about instrumental variable approaches. It is always a hard task to justify the exclusion restriction.

The area $j$ used to compute the China shock (and its instrument) is not a county, but a commuter zone (CZ). For each county $c$ in a commuter zone $j$, $IP_{c\tau} = IP_{j\tau}$ (each county is given its CZ importation penetration value).

**Q3:** What is the justification for this empirical choice?

[The justification for this empirical choice is that commuter zones are better units for employment than administrative borders. Residents in one county may be employed in a neighbouring county in the same commuter zone. Therefore, any employment shock to one county is likely spread to other counties in the same commuter zone and the use of county-level employment structures would have distorted the results.]{style="color: blue;"}

With these preliminaries in mind, we can turn to the empirical part of the problem set. For this, you need to use the dataset `populism_ps_data.dta` posted on Moodle. The dataset contains a series of variable some measured at the county level, some at the commuter zone level, and some Census region dummies. Our first step is to get to know the main variables better.

```{r q3}
data <- read_dta("populism_ps_data.dta")
```

**Q4:** Produce a table of summary statistics for the variables change (in percent) in the Republican vote shares between 2000 and 2008 and change in the Republican vote shares between 2000 and 2016 (basically the difference between `shnr_pres2008` and `shnr_pres2000` and between `shnr_pres2016` and `shnr_pres2000`, respectively). Your table should include the number of observations, the mean, the standard deviation, the minimum, the maximum, the first quartile, and the last quartile. We want to see this summary statistics in two ways: unweighted and weighted by total vote in the presidential election in 2000 (variable `totvote_2000pres`). Compare the weighted and unweighted statistics and comment on the differences.

***Answer:***

```{r q4a}
# Hint: the {TAM} package allows you to calculate weighted standard deviations and quantiles.

# unweighted
data <- data |>
  mutate(shnr_pres2008_2000 = shnr_pres2008 - shnr_pres2000,
         shnr_pres2016_2000 = shnr_pres2016 - shnr_pres2000)
f <- (`$\\Delta_{RepShare}^{2008-2000}$`=shnr_pres2008_2000)+(`$\\Delta_{RepShare}^{2016-2000}$`=shnr_pres2016_2000)~N+Mean+SD+Min+Max+(Q1=P25)+(Q3=P75)
datasummary(f, data=data,
            title="Summary statistics table for changes in the Republican vote shares (unweighted).")
```

```{r q4b}
q1 <- function(x) weighted_quantile(x, w=data$totvote_2000pres)[['25%']]
q3 <- function(x) weighted_quantile(x, w=data$totvote_2000pres)[['75%']]
f_weighted <- (`$\\Delta_{RepShare}^{2008-2000}$`=shnr_pres2008_2000)+(`$\\Delta_{RepShare}^{2016-2000}$`=shnr_pres2016_2000)~N+(Mean=weighted_mean*Arguments(w=totvote_2000pres))+(SD=weighted_sd*Arguments(w=totvote_2000pres))+Min+Max+(Q1=q1)+(Q3=q3)
datasummary(f_weighted, data=data,
            title="Summary statistics table for changes in the Republican vote shares (weighted).")
```

[As shown in Table \@ref(tab:q4a) and Table \@ref(tab:q4b), the change in Republican vote share has become more negative in terms of mean, Q1 and Q3 after weighting. This implies that the more Republican-leaning counties in 2000 experienced a more drastic fall in support for the Republican party in 2008 and a less prominent rise in 2016. On the other hand, this implies the rise in the Republican support in 2016 is attributed more to the previous Democratic-leaning rather than Republican-leaning counties.]{style="color: blue;"}

We also want to know the summary statistics for the main independent variables - Chinese import penetration (`d_imp_usch_pd_0008`) - as well as the instrument - Chinese importations in other Western countries (`d_imp_otch_lag_pd_0008`).

One issue is that this variable is measured at the commuter zone level (as discussed above), whereas the unit of analysis in the database is a county. To adequately calculate the summary statistics, we need to collapse the database. Since this is not easy and we will need this information below, here is the relevant table.

|          **Unweighted**          |      |       |          |        |       |            |            |
|:-------:|---------|---------|---------|---------|---------|---------|---------|
|                                  | Obs. | Mean  | St. Dev. | Min.   | Max.  | 1st Quart. | 3rd Quart. |
| Import Penetration US (CZ level) | 722  | 0.941 | 0.884    | -0.592 | 7.242 | 0.366      | 1.277      |
| Import Penetration IV (CZ level) | 722  | 1.111 | 1.024    | -0.426 | 6.370 | 0.361      | 1.568      |
|           **Weighted**           |      |       |          |        |       |            |            |
|                                  | Obs. | Mean  | St. Dev. | Min.   | Max.  | 1st Quart. | 3rd Quart. |
| Import Penetration US (CZ level) | 722  | 0.902 | 0.566    | -0.592 | 7.242 | 0.544      | 1.113      |
| Import Penetration IV (CZ level) | 722  | 1.161 | 0.666    | -0.426 | 6.370 | 0.758      | 1.370      |

: (#tab:given) Summary statistics for the Chinese import penetration in the US and the instrument (Chinese importations in other Western countries) at the commuter zone level.

**Q5:** Try to replicate Table \@ref(tab:given). The authors use the interquartile range (Q3 - Q1) rather than the standard deviation to interpret the political effect of the China shock. Comment on this substantive choice. To replicate this table, you first need to collapse data at the commuter zone level.

***Answer:***

```{r q5}
data_cz <- data |>
  group_by(czone) |>
  summarise(d_imp_usch_pd_0008=mean(d_imp_usch_pd_0008),
            d_imp_otch_lag_pd_0008=mean(d_imp_otch_lag_pd_0008),
            totvote_2000pres=sum(totvote_2000pres))
q1 <- function(x) weighted_quantile(x, w=data_cz$totvote_2000pres)[['25%']]
q3 <- function(x) weighted_quantile(x, w=data_cz$totvote_2000pres)[['75%']]
iqr_weighted <- function(x) q3(x) - q1(x)

f <- (`Import Penetration US (CZ level)`=d_imp_usch_pd_0008)+(`Import Penetration IV (CZ level)`=d_imp_otch_lag_pd_0008)~N+Mean+SD+Min+Max+(Q1=P25)+(Q3=P75)+IQR
f_weighted <- (`Import Penetration US (CZ level)`=d_imp_usch_pd_0008)+(`Import Penetration IV (CZ level)`=d_imp_otch_lag_pd_0008)~N+(Mean=weighted_mean*Arguments(w=totvote_2000pres))+(SD=weighted_sd*Arguments(w=totvote_2000pres))+Min+Max+(Q1=q1)+(Q3=q3)+(IQR=iqr_weighted)


unweighted <- datasummary(f, data=data_cz, fmt=3, output="data.frame")

unweighted <- rbind(c("<b>Unweighted</b>","","","","","","","",""),
                    unweighted,
                    c("<b>Weighted</b>","","","","","","","",""))
attr(unweighted, 'position') <- 1:4
                                                                        
datasummary(f_weighted, data=data_cz, fmt=3, add_rows = unweighted,
            title="Replication of Summary statistics table for the Chinese import penetration in the US and the instrument (Chinese importations in other Western countries) at the commuter zone level.")
```

[Table \@ref(tab:given) is replicated in Table \@ref(tab:q5), with interquartile ranges (IQE) added. The substantive choice of using the IQR rather than the SD does not matter as for the explanatory variable, but may affect the interpretation of the political effect. As shown in Table \@ref(tab:q5), the IQR are numerically very similar to the SD and the ordering is not affected at all for the explanatory variable. However, as for the dependent variable (change in Republican vote share), the IQR also roughly match the SD but the ordering is different if one makes a cross comparison between weighted and unweighted results. Therefore, the interpretation based on IQE is largely valid for intertemporal comparison but not for weighted-unweighted comparison.]{style="color: blue;"}

We now return to the main dataset. We first start by following the authors' approach. The results of their analysis is displayed in Table 5 in their paper. In their regressions, the authors make two choices. First, they cluster their standard error at the level of commuter zone. Second, they use total votes in 2000 as regression weight. We will first look at the first stage.

**Q6:** Regress the Chinese importation penetration in the US (`d_imp_usch_pd_0008`) on the instrument (`d_imp_otch_lag_pd_0008`). First, run the model without control. Then run the model adding controls as the authors do in Table 5. Comment your results. Note that the controls are first industry controls (`l_shind_manuf_cbp`,`l_sh_routine33`,`l_task_outsource`), then regional census dummies (the `reg_*` variables), then demographics (the variables `l_sh_pop_f`, `l_sh_pop_edu_c`,..), and finally past electoral results (`shnr_pres1992`, `shnr_pres1996`).

```{r q6}
fs1 <- feols(d_imp_usch_pd_0008 ~ d_imp_otch_lag_pd_0008, data, cluster="czone", weight=data$totvote_2000pres)
fs2 <- feols(d_imp_usch_pd_0008 ~ d_imp_otch_lag_pd_0008+l_shind_manuf_cbp+l_sh_routine33+l_task_outsource, data, cluster="czone", weight=data$totvote_2000pres)

fml3 <- paste(c("d_imp_usch_pd_0008 ~ d_imp_otch_lag_pd_0008+l_shind_manuf_cbp+l_sh_routine33+l_task_outsource", paste(grep("reg_",names(data),value=T), collapse = " + ")), collapse = " + ")
fs3 <- feols(as.formula(fml3), data, cluster="czone", weight=data$totvote_2000pres)

fml4 <- paste(c(fml3, paste(grep("l_sh_",names(data),value=T), collapse = " + ")), collapse = " + ")
fs4 <- feols(as.formula(fml4), data, cluster="czone", weight=data$totvote_2000pres)

fml5 <- paste0(fml4, " + shnr_pres1992 + shnr_pres1996")
fs5 <- feols(as.formula(fml5), data, cluster="czone", weight=data$totvote_2000pres)

fs <- list(fs1, fs2, fs3, fs4, fs5)
coef_map <- c('d_imp_otch_lag_pd_0008' = "Instrument")

gof_map <- list(list("raw" = "nobs", "clean" = "$N$", "fmt" = 0),
                list("raw" = "r.squared", "clean" = "$R^2$", "fmt" = 3),
                list("raw" = "adj.r.squared", "clean" = "$R^2$ Adj.", "fmt" = 3))

msummary(fs, stars = TRUE, coef_map = coef_map, gof_map = gof_map,
         title="First stage regressions of the Chinese import penetration in the US on the instrument (Chinese importations in other Western countries), clustered by commuter zone and weighted by the total votes in 2000.")
```

[The first stage results are displayed in Table \@ref(tab:q6). It can be seen that, once the control variables are added in columns (2) to (6), the coefficient stabilises at 0.38-0.39. Therefore, the results with controls are more reliable. Moreover, the F-stats are all over 60. This suggests it is likely that the first-stage relationship exists.]{style="color: blue;"}

**Q7:** Replicate now Table 5 (you do not need to report the method and F-stat). The authors substantively interpret their results as such:

> "The point estimate for the column 5 regression, which includes full controls, implies that the Republican two-party vote share rose by nearly a full percentage point for an interquartile range increase in import penetration ($1.59 \cdot 0.58 = 0.91$)." (page 3175)

Based on your answers to questions **Q5** and **Q6** and your knowledge of instrumental variable estimation, discuss whether this way of interpreting the results is reasonable. *(Hint: To answer this last part of the question, remember that variations in the independent variable in the second stage are only caused by variation in the instrumental variable. So the question is: How much of a variation in the instrumental variable is needed to produce a change of 0.58 in the Import penetration ratio? Is this level of variation reasonable or not? There is no right or wrong answer to this last question, rather the standard is whether your answer is substantively logical or illogical.)*

***Answer:***

```{r q7}
iva1 <- feols(shnr_pres2008_2000 ~ 1|d_imp_usch_pd_0008~d_imp_otch_lag_pd_0008, data, cluster="czone", weight=data$totvote_2000pres)
ivb1 <- feols(shnr_pres2016_2000 ~ 1|d_imp_usch_pd_0008~d_imp_otch_lag_pd_0008, data, cluster="czone", weight=data$totvote_2000pres)

h <- "shnr_pres2008_2000 ~ "
hb <- "shnr_pres2016_2000 ~ "
t <- "|d_imp_usch_pd_0008~d_imp_otch_lag_pd_0008"

fml2 <- "l_shind_manuf_cbp+l_sh_routine33+l_task_outsource"
iva2 <- feols(as.formula(paste(h,fml2,t)), data, cluster="czone", weight=data$totvote_2000pres)
ivb2 <- feols(as.formula(paste(hb,fml2,t)), data, cluster="czone", weight=data$totvote_2000pres)

fml3 <- paste(c(fml2, paste(grep("reg_",names(data),value=T), collapse = " + ")), collapse = " + ")
iva3 <- feols(as.formula(paste(h,fml3,t)), data, cluster="czone", weight=data$totvote_2000pres)
ivb3 <- feols(as.formula(paste(hb,fml3,t)), data, cluster="czone", weight=data$totvote_2000pres)
  
fml4 <- paste(c(fml3, paste(grep("l_sh_",names(data),value=T), collapse = " + ")), collapse = " + ")
iva4 <- feols(as.formula(paste(h,fml4,t)), data, cluster="czone", weight=data$totvote_2000pres)
ivb4 <- feols(as.formula(paste(hb,fml4,t)), data, cluster="czone", weight=data$totvote_2000pres)

fml5 <- paste0(fml4, " + shnr_pres1992 + shnr_pres1996")
iva5 <- feols(as.formula(paste(h,fml5,t)), data, cluster="czone", weight=data$totvote_2000pres)
ivb5 <- feols(as.formula(paste(hb,fml5,t)), data, cluster="czone", weight=data$totvote_2000pres)

iv_models <- list(list(iva1, iva2, iva3, iva4, iva5),list(ivb1, ivb2, ivb3, ivb4, ivb5))
coef_map <- c('fit_d_imp_usch_pd_0008' = "$\\Delta$CZ import penetration, 2000-2008")

glance_custom.fixest <- function(x, ...) {
  data.frame(
    industry = ifelse(any(grepl("l_shind_manuf_cbp", x$fml[[3]])), "Yes", " "),
    census = ifelse(any(grepl("reg_", x$fml[[3]])), "Yes", " "),
    demographic = ifelse(any(grepl("l_sh_pop_", x$fml[[3]])), "Yes", " "),
    electoral = ifelse(any(grepl("shnr_pres1992", x$fml[[3]])), "Yes", " ")
  )}
gof_map <- list(list("raw" = "industry", "clean" = "2000 ind/occ controls", "fmt" = NULL),
                list("raw" = "census", "clean" = "Census division dummies", "fmt" = NULL),
                list("raw" = "demographic", "clean" = "2000 demography controls", "fmt" = NULL),
                list("raw" = "electoral", "clean" = "1992/1996 election controls", "fmt" = NULL))
msummary(iv_models, stars = TRUE, coef_map = coef_map, gof_map = gof_map, shape="rcollapse",
         title="Replication of 2SLS results on Exposure to Chinese Import Competition and Presidential Election Vote Shares, 2000‚Äì2008
and 2000‚Äì2016.")
```

[The second stage results are replicated in Table \@ref(tab:q7). The authors' way of interpreting the results is not reasonable. The coefficient of 1.59 merely represents the *local* average treatment effect (LATE) that is attributable to the instrument and there is no guarantee that other variations in the independent variable ($\Delta$CZ import penetration) would exert the same size of influence. Moreover, according to the first stage (Table \@ref(tab:q6)), an interquartile range increase in import penetration (0.568) requires $\frac{0.568}{0.384\times0.699}=2.116$ standard deviations' increase in the instrument. This is very unrealistic and unreasonable.]{style="color: blue;"}

The authors make several choices along the way to produce the results we just commented. Some choices may be perfectly justified, others may be a bit more perplexing. In any case, we may want to check their consequences. This is our goal in the next questions of this problem set.

**Q8:** The first choice the authors made is to use an instrumental variable approach rather than a simple OLS method. Reproduce Table 5 in their paper, but with simple OLS rather than IV. Are the difference between IV and OLS results consistent with the authors' justification for using an IV approach?

***Answer:***

```{r q8}
OLSa1 <- feols(shnr_pres2008_2000 ~ d_imp_usch_pd_0008, data, cluster="czone", weight=data$totvote_2000pres)
OLSb1 <- feols(shnr_pres2016_2000 ~ d_imp_usch_pd_0008, data, cluster="czone", weight=data$totvote_2000pres)

h_ols <- 'shnr_pres2008_2000 ~ d_imp_usch_pd_0008 +'
hb_ols <- 'shnr_pres2016_2000 ~ d_imp_usch_pd_0008 +'
OLSa2 <- feols(as.formula(paste(h_ols,fml2)), data, cluster="czone", weight=data$totvote_2000pres)
OLSb2 <- feols(as.formula(paste(hb_ols,fml2)), data, cluster="czone", weight=data$totvote_2000pres)

OLSa3 <- feols(as.formula(paste(h_ols,fml3)), data, cluster="czone", weight=data$totvote_2000pres)
OLSb3 <- feols(as.formula(paste(hb_ols,fml3)), data, cluster="czone", weight=data$totvote_2000pres)

OLSa4 <- feols(as.formula(paste(h_ols,fml4)), data, cluster="czone", weight=data$totvote_2000pres)
OLSb4 <- feols(as.formula(paste(hb_ols,fml4)), data, cluster="czone", weight=data$totvote_2000pres)

OLSa5 <- feols(as.formula(paste(h_ols,fml5)), data, cluster="czone", weight=data$totvote_2000pres)
OLSb5 <- feols(as.formula(paste(hb_ols,fml5)), data, cluster="czone", weight=data$totvote_2000pres)

all_models <- list(list("IV"=iva1, "OLS"=OLSa1, "IV"=iva2, "OLS"=OLSa2, "IV"=iva3, "OLS"=OLSa3, "IV"=iva4, "OLS"=OLSa4, "IV"=iva5, "OLS"=OLSa5),
                   list("IV"=ivb1, "OLS"=OLSb1, "IV"=ivb2, "OLS"=OLSb2, "IV"=ivb3, "OLS"=OLSb3, "IV"=ivb4, "OLS"=OLSb4, "IV"=ivb5, "OLS"=OLSb5))

all_models1 <- list(list("IV1"=iva1, "OLS1"=OLSa1, "IV2"=iva2, "OLS2"=OLSa2, "IV3"=iva3, "OLS3"=OLSa3, "IV4"=iva4, "OLS4"=OLSa4, "IV5"=iva5, "OLS5"=OLSa5),
                   list("IV1"=ivb1, "OLS1"=OLSb1, "IV2"=ivb2, "OLS2"=OLSb2, "IV3"=ivb3, "OLS3"=OLSb3, "IV4"=ivb4, "OLS4"=OLSb4, "IV5"=ivb5, "OLS5"=OLSb5))

coef_map <- c('fit_d_imp_usch_pd_0008' = "$\\Delta$CZ import penetration, 2000-2008",
              'd_imp_usch_pd_0008' = "$\\Delta$CZ import penetration, 2000-2008")

msummary(all_models, stars = TRUE, coef_map = coef_map, gof_map = gof_map, shape="rcollapse",title="2SLS and OLS results on Exposure to Chinese Import Competition and Presidential Election Vote Shares, 2000‚Äì2008 and 2000‚Äì2016.") |>
  remove_column(12:27) |>
  add_header_above(c(" "=1, "(1)" = 2, "(2)" = 2 , "(3)" = 2, "(4)" = 2, "(5)" = 2))
```

[The IV results are juxtaposed with OLS results in Table \@ref(tab:q8). It is obvious that that the OLS results are different from the IV results. In general, the OLS estimates are lower than the IV estimates, which aligns with our expectation of a downward bias. Therefore, the IV and OLS results are consistent with the authors' justification for using an IV approach.]{style="color: blue;"}

Another important choice is to use weighted regressions. Now, there are reasons for this. Absent weights, small counties would be as important as big counties, which can create some issues. But the choice of total votes in 2000 may not be innocuous. By doing so, everything else equals, the authors may put more weight on the most politically active counties. That is, the authors may focus on the counties that react the most to the shock, generating a possible upward bias.

**Q9:** Rerun the IV regressions (including first stage) and the OLS regressions (questions *Q7* and *Q8*), but this time without weights. How do the results change compared to your analysis above?

***Answer:***

```{r q9}
iva1_u <- feols(formula(iva1),data, cluster="czone")
ivb1_u <- feols(formula(ivb1),data, cluster="czone")
OLSa1_u <- feols(formula(OLSa1),data, cluster="czone")
OLSb1_u <- feols(formula(OLSb1),data, cluster="czone")

iva2_u <- feols(formula(iva2),data, cluster="czone")
ivb2_u <- feols(formula(ivb2),data, cluster="czone")
OLSa2_u <- feols(formula(OLSa2),data, cluster="czone")
OLSb2_u <- feols(formula(OLSb2),data, cluster="czone")

iva3_u <- feols(formula(iva3),data, cluster="czone")
ivb3_u <- feols(formula(ivb3),data, cluster="czone")
OLSa3_u <- feols(formula(OLSa3),data, cluster="czone")
OLSb3_u <- feols(formula(OLSb3),data, cluster="czone")

iva4_u <- feols(formula(iva4),data, cluster="czone")
ivb4_u <- feols(formula(ivb4),data, cluster="czone")
OLSa4_u <- feols(formula(OLSa4),data, cluster="czone")
OLSb4_u <- feols(formula(OLSb4),data, cluster="czone")

iva5_u <- feols(formula(iva5),data, cluster="czone")
ivb5_u <- feols(formula(ivb5),data, cluster="czone")
OLSa5_u <- feols(formula(OLSa5),data, cluster="czone")
OLSb5_u <- feols(formula(OLSb5),data, cluster="czone")

all_models_u <- list(list("IV"=iva1_u, "OLS"=OLSa1_u, "IV"=iva2_u, "OLS"=OLSa2_u, "IV"=iva3_u, "OLS"=OLSa3_u, "IV"=iva4_u, "OLS"=OLSa4_u, "IV"=iva5_u, "OLS"=OLSa5_u),
                   list("IV"=ivb1_u, "OLS"=OLSb1_u, "IV"=ivb2_u, "OLS"=OLSb2_u, "IV"=ivb3_u, "OLS"=OLSb3_u, "IV"=ivb4_u, "OLS"=OLSb4_u, "IV"=ivb5_u, "OLS"=OLSb5_u))

msummary(all_models_u, stars = TRUE, coef_map = coef_map, gof_map = gof_map, shape="rcollapse",title="2SLS and OLS results on Exposure to Chinese Import Competition and Presidential Election Vote Shares, 2000‚Äì2008 and 2000‚Äì2016 (unweighted)") |>
  remove_column(12:27) |>
  add_header_above(c(" "=1, "(1)" = 2, "(2)" = 2 , "(3)" = 2, "(4)" = 2, "(5)" = 2))

```

[The unweighted IV and OLS results are shown in Table \@ref(tab:q9). In general, the coefficients are smaller, with some previously significant coefficients becoming statistically insignificant. This means that our worry about an upward bias is valid. It is likely that the more politically active counties are given more weight and their reactions are amplified.]{style="color: blue;"}

A third choice to note is that the authors use the change in Chinese importation penetration from 2000 to 2008 for both the 2008 and 2016 elections. This means there is quite a bit of a delay between the shock (measured over 2000-2008) and the consequences measured in 2016. In other parts of the paper, the authors look at penetration change from 2002 to 2010.3 This variable is closer in time from 2016 making it important to check the robustness of the results to this alternative measure of the China shock.

**Q10:** Rerun the IV analysis (keeping the same instrument as the authors and using weights) for the 2016 elections using the Chinese importation penetration increases over the 2002-2010 period. How do the results change compare to the authors' analysis?

To find the Chinese importation penetration increases over the 2002-2010 period, use the database `populism_ps_data_additional.dta` (available on Moodle) and merge it with the main database you have been using. To do so, you need to use the command `inner_join()` (since the database you use is at the czone level) using `cty_fips` as merging variable. Drop the three unmatched observations. The new instrument you need to use is `d_imp_usch_pd`.

***Answer:***

```{r q10}
data_new <- read_dta("populism_ps_data_additional_nodup.dta")
data_new <- inner_join(data, data_new, by=c("cty_fips", "czone"), keep=F)

iva1_new <- capture.output(formula(iva1)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
ivb1_new <- capture.output(formula(ivb1)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSa1_new <- capture.output(formula(OLSa1))[1] |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSb1_new <- capture.output(formula(OLSb1))[1] |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)

iva2_new <- capture.output(formula(iva2)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
ivb2_new <- capture.output(formula(ivb2)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSa2_new <- paste0(capture.output(formula(OLSa2))[1:2]) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSb2_new <- paste0(capture.output(formula(OLSb2))[1:2]) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)

iva3_new <- capture.output(formula(iva3)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
ivb3_new <- capture.output(formula(ivb3)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSa3_new <- paste0(capture.output(formula(OLSa3))[1:4]) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSb3_new <- paste0(capture.output(formula(OLSb3))[1:4]) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)

iva4_new <- capture.output(formula(iva4)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
ivb4_new <- capture.output(formula(ivb4)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSa4_new <- capture.output(formula(OLSa4))[1:8] |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSb4_new <- capture.output(formula(OLSb4))[1:8] |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)

iva5_new <- capture.output(formula(iva5)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
ivb5_new <- capture.output(formula(ivb5)) |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |>
  str_replace("d_imp_otch_lag_pd_0008","d_imp_otch_lag_pd_2010") |> as.formula() |>
  feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSa5_new <- capture.output(formula(OLSa5))[1:9] |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)
OLSb5_new <- capture.output(formula(OLSb5))[1:9] |> str_replace("d_imp_usch_pd_0008","d_imp_usch_pd") |> as.formula() |> feols(data=data_new, cluster="czone", weights = data_new$totvote_2000pres)

all_models_new <- list(list("IV"=ivb1, "OLS"=OLSb1, "IV"=ivb2, "OLS"=OLSb2, "IV"=ivb3, "OLS"=OLSb3, "IV"=ivb4, "OLS"=OLSb4, "IV"=ivb5, "OLS"=OLSb5),
  list("IV"=ivb1_new, "OLS"=OLSb1_new, "IV"=ivb2_new, "OLS"=OLSb2_new, "IV"=ivb3_new, "OLS"=OLSb3_new, "IV"=ivb4_new, "OLS"=OLSb4_new, "IV"=ivb5_new, "OLS"=OLSb5_new))

coef_map <- c('fit_d_imp_usch_pd_0008' = "$\\Delta$CZ import penetration, 2000-2008",
              'd_imp_usch_pd_0008' = "$\\Delta$CZ import penetration, 2000-2008",
  'fit_d_imp_usch_pd' = "$\\Delta$CZ import penetration, 2002-2010",
              'd_imp_usch_pd' = "$\\Delta$CZ import penetration, 2002-2010")

msummary(all_models_new, stars = TRUE, coef_map = coef_map, gof_map = gof_map, shape="rcollapse", title="2SLS and OLS results on Exposure to Chinese Import Competition and 2016 Presidential Election Vote Shares (weighted)") |>
  remove_column(12:27) |>
  add_header_above(c(" "=1, "(1)" = 2, "(2)" = 2 , "(3)" = 2, "(4)" = 2, "(5)" = 2))
```

[The IV and OLS results using both 2000-2008 and 2002-2010 data are shown in Table \@ref(tab:q10). Coefficients are largely similar, except for (3). However, previously significant results have become insignificant due to inflated standard errors. This suggests that there may be more uncertainty than the authors' original results, and the results are not very robust.]{style="color: blue;"}

One other questionable choice is to perform the analysis at the county level, whereas the treatment (the China shock) is measured at the commuter zone level.

**Q11:** Rerun the IV analysis (keeping the same measure for the China shock and the same instrument as the authors) for the 2008 and 2016 elections at the community zone level. How do the results change compare to the authors' analysis?

To answer this question, you will have to use the `summarise` commands as you did for question 5. When you collapse the data, weight them by the weights the authors use. Run your IV estimations without clustering.

***Answer:***

```{r q11}
data_cz <- data |>
  group_by(czone) |>
  summarise(across(shnr_pres2000:shnr_pres2016_2000, ~ weighted.mean(.x, w=totvote_2000pres)))

iva1_cz <- feols(formula(iva1), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")
ivb1_cz <- feols(formula(ivb1), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")

iva2_cz <- feols(formula(iva2), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")
ivb2_cz <- feols(formula(ivb2), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")

iva3_cz <- feols(formula(iva3), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")
ivb3_cz <- feols(formula(ivb3), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")

iva4_cz <- feols(formula(iva4), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")
ivb4_cz <- feols(formula(ivb4), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")

iva5_cz <- feols(formula(iva5), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")
ivb5_cz <- feols(formula(ivb5), data=data_cz, weights=data_cz$totvote_2000pres, vcov="HC1")

all_models_cz <- list(list("County"=iva1,"CZ"=iva1_cz, "County"=iva2,"CZ"=iva2_cz, "County"=iva3,"CZ"=iva3_cz, "County"=iva4,"CZ"=iva4_cz, "County"=iva5,"CZ"=iva5_cz),
  list("County"=ivb1,"CZ"=ivb1_cz, "County"=ivb2,"CZ"=ivb2_cz, "County"=ivb3,"CZ"=ivb3_cz, "County"=ivb4,"CZ"=ivb4_cz, "County"=ivb5,"CZ"=ivb5_cz))

msummary(all_models_cz, stars = TRUE, coef_map = coef_map, gof_map = gof_map, shape="rcollapse", title="2SLS and OLS results on Exposure to Chinese Import Competition and Presidential Election Vote Shares, 2000‚Äì2008 and 2000‚Äì2016 at county and CZ levels") |>
  remove_column(12:27) |>
  add_header_above(c(" "=1, "(1)" = 2, "(2)" = 2 , "(3)" = 2, "(4)" = 2, "(5)" = 2))
```

[The county-level and CZ-level results are juxtaposed in Table \@ref(tab:q11). It can be seen that the coefficients for 2008 election results have been lower, but those for 2016 election results remain largely the same after collapsing. This suggests that the latter results do not depend on the level of data (county or CZ), while the former do. The authors' choice of county-level data is appropriate since it uses more information.]{style="color: blue;"}

**Q12:** The authors describe their paper as finding

> "strong though not definitive evidence of an ideological realignment in trade-exposed local labor markets that commences prior to the divisive 2016 US presidential election."

Based on your re-analysis of the presidential results, do you agree with their conclusion?

***Answer:***

[I do not agree with their conclusion. Their 2008 results are not robust to unweighted data or CZ-level reanalysis. The authors therefore only provide weak evidence for their claim. Even the realignment at the time of 2016 election is questionable as the results become uncertain when one uses later import penetration data (2002-2010).]{style="color: blue;"}

# Appendix: All code in this assignment

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```

